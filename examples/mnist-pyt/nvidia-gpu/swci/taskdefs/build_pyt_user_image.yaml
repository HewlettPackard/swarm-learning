######################################################################
# (C)Copyright 2021,2022 Hewlett Packard Enterprise Development LP
######################################################################
Name: build_pyt_user_image
TaskType: MAKE_USER_CONTAINER
Author: HPESwarm
Prereq: ROOTTASK
Outcome: user-image-nvidia-pyt
Body:
    BuildContext: sl-cli-lib
    BuildType: INLINE
    BuildSteps:
    - FROM nvidia/cuda:10.2-devel-ubuntu18.04
    - RUN apt-get update && apt-get install -y apt-transport-https software-properties-common
    - RUN add-apt-repository -y ppa:deadsnakes/ppa
    - RUN apt-get install -y python3.8
    - RUN rm /usr/bin/python3
    - RUN ln -s /usr/bin/python3.8 /usr/bin/python3
    - RUN apt-get install -y python3-pip
    - RUN pip3 install --upgrade pip
    - RUN pip3 install imutils opencv-python pandas pillow service_identity sklearn networkx
    - RUN pip3 install torch==1.9.0+cu102 torchvision==0.10.0+cu102 torchaudio==0.9.0 -f https://download.pytorch.org/whl/torch_stable.html
    - RUN mkdir -p /tmp/hpe-swarmcli-pkg
    - COPY swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl /tmp/hpe-swarmcli-pkg/swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl
    - RUN pip3 install /tmp/hpe-swarmcli-pkg/swarmlearning-client-py3-none-manylinux_2_24_x86_64.whl
